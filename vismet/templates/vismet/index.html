{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Instituto de Estudos Climáticos do Espírito Santo</title>
    <link type="text/css" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link type="text/css" rel="stylesheet" href="{% static 'vismet/libs/leaflet/leaflet.css' %}">
    <link type="text/css" rel="stylesheet" href="{% static 'vismet/css/main.css' %}">

    <style>
      .sidenav {
        height: 100%;
        width: 120px;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #ededed;
        overflow-x: hidden;
        padding-top: 20px;
      }

      .sidenav a {
        font-family: Futura;
        padding: 6px 8px 6px 6px;
        text-decoration: none;
        font-size: 21px;
        color: #454545;
        display: block;
        text-align: center;
      }

      .sidenav a:hover {
        color: #242424;
        /*background-color: #dbdbdb;*/
      }


      .main {
        margin-left: 120px; /* Same as the width of the sidenav */
        padding: 0px 10px;
      }

      @media screen and (max-height: 450px) {
        .sidenav {padding-top: 15px;}
        .sidenav a {font-size: 18px;}
      }
    </style>

  </head>
  <body>
    <div class="sidenav">
      <a id="estacoesxavier" href="#">Dados<br>Históricos<hr></a>
      <!-- <a id="satelitereanalise" href="#">Satélite e<br>Reanálise<hr></a> -->
      <a id="cenariosfuturos" href="#">Cenários<br>Futuros</a>
<!--  <a href="#sobre-bar">Sobre</a> -->
    </div>

    <div class="main">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-3" id="sidebar">
          <h1><a href="{% url 'home:index' %}">IEC-ES</a></h1>
          <div id="porEstacao">
            <h3>Estações meteorológicas:</h3>
            <p>Dados históricos coletados pelas estações meteorológicas.</p>
            <form action="" method="get">
              {% csrf_token %}
              <label for="variable">Variável:</label>
              <select id="station_variable" name="variable">
                <option value="maxTemp">Temperatura Máxima</option>
                <option value="minTemp">Temperatura Mínima</option>
                <!-- <option value="evapo">Evapotranspiração</option> -->
                <!-- <option value="relHum">Umidade Relativa</option> -->
                <!-- <option value="solarRad">Radiação Solar</option> -->
                <!-- <option value="windSpeed">Velocidade do Vento</option> -->
              </select>
              <input type="hidden" name="ommcode" value="0" id="input_ommcode">
              <label for="startDate">Data inicial:</label>
              <input class="dateinput" type="text" id="startDate" name="startDate">
              <label for="finalDate">Data final:</label>
              <input class="dateinput" type="text" id="finalDate" name="finalDate">

              <button type="button" id="btn_submit">Visualizar</button>
              <button type="button" id="btn_download" name="btn_download">Baixar</button>
            </form><br>
          </div>

          <select id="cenarios-futuros-layer">
            <option value="city">Município</option>
            <option value="pixel">Pixel</option>
          </select>

          <div id="porMunicipio">
            <h3>Município:</h3>
            <p>Média por município dos dados do Modelo Eta HADGEM2-ES 5km para o estado de Espírito Santo.</p>
            <form class="" action="" method="get">
              <input type="hidden" value="0" id="city_name">
              <label for="city_startDate">Data inicial:</label>
              <input class="dateinput" type="text" id="city_startDate" name="city_startDate">
              <label for="city_finalDate">Data final:</label>
              <input class="dateinput" type="text" id="city_finalDate" name="city_finalDate">
              <!-- <button type="button" id="btn_view_city_data">Visualizar</button> -->
              <button type="button" id="btn_download_city_data">Baixar</button>
            </form><br>
          </div>

          <div id="porPixel">
          <h3>Pixels:</h3>
          <p>Dados do Modelo Eta HADGEM2-ES por pixel de 5km para o estado de Espírito Santo</p>
          <form class="" action="" method="get">
            <input type="hidden" value="0" id="pixel_id">
            <label for="pixel_startDate">Data inicial:</label>
            <input class="dateinput" type="text" id="pixel_startDate" name="pixel_startDate">
            <label for="pixel_finalDate">Data final:</label>
            <input class="dateinput" type="text" id="pixel_finalDate" name="pixel_finalDate">
            <button type="button" id="btn_pixel">Baixar</button>
          </form>
          </div>
        </div>

        <div class="col-md-9">
          <div class="row">
            <div id="map"></div>
          </div>
          <div class="row">
            <canvas id="chart" height="65"></canvas>
          </div>
        </div>
      </div>

    <input type="hidden"  id="xavier-station-geojson" value="{% url 'vismet:xavier_stations' %}">
    <input type="hidden" id="cities-geojson" value="{% url 'vismet:cities' %}">
    <input type="hidden" id="url-pixel" value="{% url 'vismet:pixel' %}">
    </div></div>

    <!-- CDNs das bibliotecas -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://unpkg.com/@popperjs/core@2"></script>
    <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

    <script type="text/javascript" src="{% static 'vismet/libs/leaflet/leaflet.js' %}"></script>

    <!-- JS próprios da plataforma  -->
    <script type="text/javascript" src="{% static 'vismet/js/chart.js' %}"></script>
    <script type="text/javascript" src="{% static 'vismet/js/map.js' %}"></script>
    <script type="text/javascript" src="{% static 'vismet/js/xavier-stations.js' %}"></script>
    <script type="text/javascript" src="{% static 'vismet/js/cities.js' %}"></script>
    <script type="text/javascript" src="{% static 'vismet/js/pixels.js' %}"></script>
    <script type="text/javascript" src="{% static 'vismet/js/init.js' %}"></script>

    <script type="text/javascript">
      var url_api_xavierstation = "{% url 'vismet:xavier_stations' %}";
    </script>

    <script type="text/javascript">
     $(".dateinput").datepicker({
       showOn: 'focus',
       dateFormat: 'dd/mm/yy',
       dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],
       dayNamesMin: ['D','S','T','Q','Q','S','S','D'],
       dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb','Dom'],
       defaultDate: new Date(1980, 0, 1),
       monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
       monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
       nextText: 'Próximo',
       prevText: 'Anterior',
       minDate: new Date(1980, 0, 1),
       maxDate: '-1d',
       changeYear: true,
       yearRange: "1960:2020",
       changeMonth: true,
     });
    </script>

    <script>
      map.addLayer(xaviewrWeatherStation);
      document.getElementById("porEstacao").style.display = "block";
      document.getElementById("porMunicipio").style.display = "none";
      document.getElementById("porPixel").style.display = "none";
      document.getElementById("cenarios-futuros-layer").style.display = "none";

      document.getElementById("estacoesxavier").addEventListener("click", displayXavier);
      // document.getElementById("satelitereanalise").addEventListener("click", displaySatelite);
      document.getElementById("cenariosfuturos").addEventListener("click", displayFuturo);

      var XavierIsOn = true;
      var PixelIsOn = false;

      function displayXavier() {
        if(XavierIsOn){
          map.removeLayer(xaviewrWeatherStation);
          XavierIsOn = false;
        }
        else{
          map.addLayer(xaviewrWeatherStation);
          XavierIsOn = true;

          map.removeLayer(pixels_layer);
          map.removeLayer(cities_layer);
          PixelIsOn = false;

          document.getElementById("porEstacao").style.display = "block";
          document.getElementById("porMunicipio").style.display = "none";
          document.getElementById("porPixel").style.display = "none";
          document.getElementById("cenarios-futuros-layer").style.display = "none";
        }
      }

      function displayFuturo() {
        if(PixelIsOn){
          map.removeLayer(pixels_layer);
          PixelIsOn = false;
        }
        else{
          map.addLayer(pixels_layer);
          PixelIsOn = true;

          map.removeLayer(xaviewrWeatherStation);
          removeData(chart);
          chart.options.title.text = "";
          chart.update();
          XavierIsOn = false;

          document.getElementById("porEstacao").style.display = "none";
          document.getElementById("porMunicipio").style.display = "none";
          document.getElementById("porPixel").style.display = "block";
          document.getElementById("cenarios-futuros-layer").style.display = "block";
          document.getElementById("cenarios-futuros-layer").value = "pixel";
        }
      }

      document.getElementById("cenarios-futuros-layer").addEventListener("change", function(){
        var value = this.value;

        if(value == "city"){
          document.getElementById("porMunicipio").style.display = "block";
          document.getElementById("porPixel").style.display = "none";

          map.removeLayer(pixels_layer);
          map.addLayer(cities_layer);

          console.log("muda pra city");
        }
        else if(value == "pixel"){
          document.getElementById("porMunicipio").style.display = "none";
          document.getElementById("porPixel").style.display = "block";

          map.removeLayer(cities_layer);
          map.addLayer(pixels_layer);

          console.log("muda pra pixel");
        }
      })

      function displaySatelite() {
      }
    </script>
  </body>
</html>
